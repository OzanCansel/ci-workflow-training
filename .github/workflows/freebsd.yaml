name: Test

on:
  pull_request_target:
  push:
    branches: [ master ]
  workflow_dispatch:

jobs:
  test:
    runs-on: macos-12
    strategy:
      fail-fast: false
      matrix:
        release:
          - version: 12.3
          - version: 13.0
          - version: 13.1

    name: FreeBSD
    steps:
    - uses: actions/checkout@v3
    - name: Build
      id: test
      uses: vmactions/freebsd-vm@v0
      with:
        usesh: true
        prepare: |
          pkg install -y curl \
                         gcc \
                         git \
                         gmake \
                         cmake \
                         autoconf \
                         automake \
                         libtool \
                         libiconv \
                         gettext \
                         openssl \
                         libmaxminddb \
                         tinycdb \
                         screen \
                         bash
          portsnap fetch extract
          portsnap fetch update

          cd /usr/ports/databases/sqlite3
          make BATCH=yes OPTIONS_SET=STATIC install clean

        run: |
          ls -lah
          ls -lh /usr/local/lib/libsqlite3*
